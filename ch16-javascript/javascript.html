<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
        <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>16. JavaScript &#8212; Qt5 Cadaques Book vmaster</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom-styles.css" type="text/css" />
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="17. Qt and C++" href="../ch17-qtcpp/qtcpp.html" />
    <link rel="prev" title="15. Dynamic QML" href="../ch15-dynamicqml/dynamicqml.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          QmlBook</a>
        <span class="navbar-text navbar-version pull-left"><b>master</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Chapters <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../ch01-meetqt/meetqt.html">1. Meet Qt 5</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch02-start/start.html">2. Get Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch03-qtcreator/qtcreator.html">3. Qt Creator IDE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch04-qmlstart/qmlstart.html">4. Quick Starter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch05-fluid/fluid.html">5. Fluid Elements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch06-controls/controls.html">6. Qt Quick Controls 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch07-modelview/modelview.html">7. Model-View-Delegate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch08-felgo/felgo.html">8. Felgo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch09-canvas/canvas.html">9. Canvas Element</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch10-particles/particles.html">10. Particle Simulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch11-shaders/shaders.html">11. Shader Effects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch12-multimedia/multimedia.html">12. Multimedia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch13-networking/networking.html">13. Networking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch14-storage/storage.html">14. Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch15-dynamicqml/dynamicqml.html">15. Dynamic QML</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">16. JavaScript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch17-qtcpp/qtcpp.html">17. Qt and C++</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch18-extensions/extensions.html">18. Extending QML with C++</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch19-felgo-plugins/felgo-plugins.html">19. Felgo Plugins and QML Hot Reloading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ch20-python/python.html">20. Qt for Python</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../testing/testing.html">1. Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment/deployment.html">2. Deploying QML Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../draganddrop/draganddrop.html">3. Drag and Drop</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">16. JavaScript</a><ul>
<li><a class="reference internal" href="#browser-html-vs-qtquick-qml">16.1. Browser/HTML vs QtQuick/QML</a></li>
<li><a class="reference internal" href="#the-language">16.2. The Language</a></li>
<li><a class="reference internal" href="#js-objects">16.3. JS Objects</a></li>
<li><a class="reference internal" href="#creating-a-js-console">16.4. Creating a JS Console</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="../ch15-dynamicqml/dynamicqml.html" title="Previous Chapter: 15. Dynamic QML"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; 15. Dynamic QML</span>
    </a>
  </li>
  <li>
    <a href="../ch17-qtcpp/qtcpp.html" title="Next Chapter: 17. Qt and C++"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">17. Qt and C++ &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">16. JavaScript</a><ul>
<li><a class="reference internal" href="#browser-html-vs-qtquick-qml">16.1. Browser/HTML vs QtQuick/QML</a></li>
<li><a class="reference internal" href="#the-language">16.2. The Language</a></li>
<li><a class="reference internal" href="#js-objects">16.3. JS Objects</a></li>
<li><a class="reference internal" href="#creating-a-js-console">16.4. Creating a JS Console</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="body col-md-9 content" role="main">
      
  <div class="section" id="javascript">
<h1>16. JavaScript<a class="headerlink" href="#javascript" title="Permalink to this headline">Â¶</a></h1>
<p><em>Section author: <a class="reference external" href="https://www.linkedin.com/in/jryannel">jryannel&#64;LinkedIn</a></em></p>
<p><div class="btn-group btn-group-justified" role="group"><a class="btn btn-primary btn-xs" href="https://github.com/qmlbook/qmlbook/" target="_blank">Github</a><a class="btn btn-primary btn-xs" href="https://github.com/qmlbook/qmlbook//blob/master/docs/ch16-javascript/javascript.rst" target="_blank"><i class="glyphicon glyphicon-file"></i> View</a><a class="btn btn-primary btn-xs" href="https://github.com/qmlbook/qmlbook//edit/master/docs/ch16-javascript/javascript.rst" target="_blank"><i class="glyphicon glyphicon-pencil"></i> Edit</a><a class="btn btn-primary btn-xs" href="https://github.com/qmlbook/qmlbook//issues/new?labels=ch16&body=back-link%3A+ch16-javascript%2Fjavascript.html%23javascript" target="_blank"><i class="glyphicon glyphicon-plus"></i> Issue </a><a  class="btn btn-primary btn-xs" href="https://github.com/qmlbook/qmlbook//issues?labels=ch16&page=1&state=open" target="_blank"><i class="glyphicon glyphicon-search"></i> Issues</a></div></p><div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Last Build: November 10, 2020 at 09:29 CET</p>
<p class="last">The source code for this chapter can be found in the <a class="reference external" href="../assets">assets folder</a>.</p>
</div>
<p>JavaScript is the lingua-franca on web client development. It also starts to get traction on web server development mainly by node js. As such it is a well-suited addition as an imperative language onto the side of declarative QML language. QML itself as a declarative language is used to express the user interface hierarchy but is limited to express operational code. Sometimes you need a way to express operations, here JavaScript comes into play.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>There is an open question in the Qt community about the right mixture about QML/JS/QtC++ in a modern Qt application. The commonly agreed recommended mixture is to limit the JS part of your application to a minimum and do your business logic inside QtC++ and the UI logic inside QML/JS.</p>
<p class="last">This book pushes the boundaries, which is not always the right mix for a product development and not for everyone. It is important to follow your team skills and your personal taste. In doubt follow the recommendation.</p>
</div>
<p>Here a short example of how JS used in QML looks like:</p>
<div class="highlight-qml notranslate"><div class="highlight"><pre><span></span><span class="nx">Button</span> <span class="p">{</span>
  <span class="k">width:</span> <span class="mi">200</span>
  <span class="k">height:</span> <span class="mi">300</span>
  <span class="nx">property</span> <span class="nx">bool</span> <span class="k">checked:</span> <span class="kc">false</span>
  <span class="k">text:</span> <span class="s2">&quot;Click to toggle&quot;</span>

  <span class="c1">// JS function</span>
  <span class="kd">function</span> <span class="nx">doToggle</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">checked</span> <span class="o">=</span> <span class="o">!</span><span class="nx">checked</span>
  <span class="p">}</span>

  <span class="k">onTriggered:</span> <span class="p">{</span>
    <span class="c1">// this is also JavaScript</span>
    <span class="nx">doToggle</span><span class="p">();</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;checked: &#39;</span> <span class="o">+</span> <span class="nx">checked</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>So JavaScript can come in many places inside QML as a standalone JS function, as a JS module and it can be on every right side of a property binding.</p>
<div class="highlight-qml notranslate"><div class="highlight"><pre><span></span><span class="kr">import</span> <span class="s2">&quot;util.js&quot;</span> <span class="nx">as</span> <span class="nx">Util</span> <span class="c1">// import a pure JS module</span>

<span class="nx">Button</span> <span class="p">{</span>
  <span class="k">width:</span> <span class="mi">200</span>
  <span class="k">height:</span> <span class="nx">width</span><span class="o">*</span><span class="mi">2</span> <span class="c1">// JS on the right side of property binding</span>

  <span class="c1">// standalone function (not really useful)</span>
  <span class="kd">function</span> <span class="nx">log</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Button&gt; &quot;</span> <span class="o">+</span> <span class="nx">msg</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">onTriggered:</span> <span class="p">{</span>
    <span class="c1">// this is JavaScript</span>
    <span class="nx">log</span><span class="p">();</span>
    <span class="nx">Qt</span><span class="p">.</span><span class="nx">quit</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Within QML you declare the user interface, with JavaScript you make it functional. So how much JavaScript should you write? It depends on your style and how familiar you are with JS development. JS is a loosely typed language, which makes it difficult to spot type defects. Also, functions expect all argument variations, which can be a very nasty bug to spot. The way to spot defects is rigorous unit testing or acceptance testing. So if you develop real logic (not some glue lines of code) in JS you should really start using the test-first approach. In generally mixed teams (Qt/C++ and QML/JS) are very successful when they minimize the amount of JS in the frontend as the domain logic and do the heavy lifting in Qt C++ in the backend. The backend should then be rigorous unit tested so that the frontend developers can trust the code and focus on all these little user interface requirements.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In general: backend developers are functional driven and frontend developers are user story driven.</p>
</div>
<div class="section" id="browser-html-vs-qtquick-qml">
<h2>16.1. Browser/HTML vs QtQuick/QML<a class="headerlink" href="#browser-html-vs-qtquick-qml" title="Permalink to this headline">Â¶</a></h2>
<p>The browser is the runtime to render HTML and execute the Javascript associated with the HTML. Nowadays modern web applications contain much more JavaScript than HTML. The Javascript inside the browser is a standard ECMAScript environment with some additional browser APIs. A typical JS environment inside the browser has a global object named <code class="docutils literal notranslate"><span class="pre">window</span></code> which is used to interact with the browser window (title, location URL, DOM tree etc.) Browsers provide functions to access DOM nodes by their id, class etc. (which were used by jQuery to provide the CSS selectors) and recently also by CSS selectors (<code class="docutils literal notranslate"><span class="pre">querySelector</span></code>, <code class="docutils literal notranslate"><span class="pre">querySelectorAll</span></code>). Additionally, there is a possibility to call a function after a certain amount of time (<code class="docutils literal notranslate"><span class="pre">setTimeout</span></code>) and to call it repeatedly (<code class="docutils literal notranslate"><span class="pre">setInterval</span></code>). Besides these (and other browser APIs), the environment is similar to QML/JS.</p>
<p>Another difference is how JS can appear inside HTML and QML. In HTML, you can execute JS only during the initial page load or in event handlers (e.g. page loaded, mouse pressed). For example, your JS initializes normally on page load, which is comparable to <code class="docutils literal notranslate"><span class="pre">Component.onCompleted</span></code> in QML. By default, you cannot use JS for property bindings in a browser (AngularJS enhances the DOM tree to allow these, but this is far away from standard HTML).</p>
<p>In QML, JS is a much more of a first-class citizen and is much deeper integrated into the QML render tree. Which makes the syntax much more readable. Besides this differences, people who have developed HTML/JS applications should feel at home using QML/JS.</p>
</div>
<div class="section" id="the-language">
<h2>16.2. The Language<a class="headerlink" href="#the-language" title="Permalink to this headline">Â¶</a></h2>
<p>This chapter will not give you a general introduction to JavaScript. There are other books out there for a general introduction to JavaScript, please visit this great side on <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/A_re-introduction_to_JavaScript">Mozilla Developer Network</a>.</p>
<p>On the surface JavaScript is a very common language and does not differ a lot from other languages:</p>
<div class="highlight-qml notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">countDown</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;index: &#39;</span> <span class="o">+</span> <span class="nx">i</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">countDown2</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">10</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span> <span class="nx">i</span><span class="o">&gt;</span><span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">i</span><span class="o">--</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>But be warned JS has function scope and not block scope as in C++ (see <a class="reference external" href="https://developer.mozilla.org/it/docs/Web/JavaScript/Reference/Functions_and_function_scope">Functions and function scope</a>).</p>
<p>The statements <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">...</span> <span class="pre">else</span></code>, <code class="docutils literal notranslate"><span class="pre">break</span></code>, <code class="docutils literal notranslate"><span class="pre">continue</span></code> also work as expected. The switch case can also compare other types and not just integer values:</p>
<div class="highlight-qml notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">getAge</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// switch over a string</span>
  <span class="k">switch</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">case</span> <span class="s2">&quot;father&quot;</span><span class="o">:</span>
    <span class="k">return</span> <span class="mi">58</span><span class="p">;</span>
  <span class="k">case</span> <span class="s2">&quot;mother&quot;</span><span class="o">:</span>
    <span class="k">return</span> <span class="mi">56</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">unknown</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>JS knows several values which can be false, e.g. <code class="docutils literal notranslate"><span class="pre">false</span></code>, <code class="docutils literal notranslate"><span class="pre">0</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">undefined</span></code>, <code class="docutils literal notranslate"><span class="pre">null</span></code>). For example, a function returns by default <code class="docutils literal notranslate"><span class="pre">undefined</span></code>. To test for false use the <code class="docutils literal notranslate"><span class="pre">===</span></code> identity operator. The <code class="docutils literal notranslate"><span class="pre">==</span></code> equality operator will do type conversion to test for equality. If possible use the faster and better <code class="docutils literal notranslate"><span class="pre">===</span></code> strict equality operator which will test for identity (see <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Comparison_Operators">Comparison operators</a>.</p>
<p>Under the hood, javascript has its own ways of doing things. For example arrays:</p>
<div class="highlight-qml notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">doIt</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1">// empty arrays</span>
  <span class="nx">a</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1">// addend number on arrays</span>
  <span class="nx">a</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;Monkey&quot;</span><span class="p">)</span> <span class="c1">// append string on arrays</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="c1">// prints 2</span>
  <span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1">// returns 10</span>
  <span class="nx">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1">// returns Monkey</span>
  <span class="nx">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="c1">// returns undefined</span>
  <span class="nx">a</span><span class="p">[</span><span class="mi">99</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;String&quot;</span> <span class="c1">// a valid assignment</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="c1">// prints 100</span>
  <span class="nx">a</span><span class="p">[</span><span class="mi">98</span><span class="p">]</span> <span class="c1">// contains the value undefined</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Also for people coming from C++ or Java which are used to an OO language JS just works differently. JS is not purely an OO language it is a so-called prototype based language. Each object has a prototype object. An object is created based on his prototype object. Please read more about this in the book <a class="reference external" href="http://javascript.crockford.com">Javascript the Good Parts by Douglas Crockford</a> or watch the video below.</p>
<iframe src="http://www.youtube.com/embed/hQVTIJBZook" style="border: 0; height: 345px; width: 560px">
</iframe><p>To test some small JS snippets you can use the online <a class="reference external" href="http://jsconsole.com">JS Console</a> or just build a little piece of QML code:</p>
<div class="highlight-qml notranslate"><div class="highlight"><pre><span></span><span class="kr">import</span> <span class="nx">QtQuick</span> <span class="mf">2.5</span>

<span class="nx">Item</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="nx">runJS</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Your JS code goes here&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">Component.onCompleted:</span> <span class="p">{</span>
    <span class="nx">runJS</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="js-objects">
<h2>16.3. JS Objects<a class="headerlink" href="#js-objects" title="Permalink to this headline">Â¶</a></h2>
<p>While working with JS there are some objects and methods which are more frequently used. This is a small collection of them.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">Math.floor(v)</span></code>, <code class="docutils literal notranslate"><span class="pre">Math.ceil(v)</span></code>, <code class="docutils literal notranslate"><span class="pre">Math.round(v)</span></code> - largest, smallest, rounded integer from float</li>
<li><code class="docutils literal notranslate"><span class="pre">Math.random()</span></code> - create a random number between 0 and 1</li>
<li><code class="docutils literal notranslate"><span class="pre">Object.keys(o)</span></code> - get keys from object (including QObject)</li>
<li><code class="docutils literal notranslate"><span class="pre">JSON.parse(s)</span></code>, <code class="docutils literal notranslate"><span class="pre">JSON.stringify(o)</span></code> - conversion between JS object and JSON string</li>
<li><code class="docutils literal notranslate"><span class="pre">Number.toFixed(p)</span></code> - fixed precision float</li>
<li><code class="docutils literal notranslate"><span class="pre">Date</span></code> - Date manipulation</li>
</ul>
<p>You can find them also at: <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference">JavaScript reference</a></p>
<p>Here some small and limited examples of how to use JS with QML. They should give you an idea how you can use JS inside QML</p>
<p class="rubric">Print all keys from QML Item</p>
<div class="highlight-qml notranslate"><div class="highlight"><pre><span></span><span class="nx">Item</span> <span class="p">{</span>
  <span class="kd">id: root</span>
  <span class="k">Component.onCompleted:</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">keys</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">root</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">keys</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="c1">// prints all properties, signals, functions from object</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">key</span> <span class="o">+</span> <span class="s1">&#39; : &#39;</span> <span class="o">+</span> <span class="nx">root</span><span class="p">[</span><span class="nx">key</span><span class="p">]);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p class="rubric">Parse an object to a JSON string and back</p>
<div class="highlight-qml notranslate"><div class="highlight"><pre><span></span><span class="nx">Item</span> <span class="p">{</span>
  <span class="nx">property</span> <span class="kd">var</span> <span class="k">obj:</span> <span class="p">{</span>
    <span class="k">key:</span> <span class="s1">&#39;value&#39;</span>
  <span class="p">}</span>

  <span class="k">Component.onCompleted:</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">key</span><span class="p">);</span> <span class="c1">// &gt; &#39;value&#39;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p class="rubric">Current Date</p>
<div class="highlight-qml notranslate"><div class="highlight"><pre><span></span><span class="nx">Item</span> <span class="p">{</span>
  <span class="nx">Timer</span> <span class="p">{</span>
    <span class="kd">id: timeUpdater</span>
    <span class="k">interval:</span> <span class="mi">100</span>
    <span class="k">running:</span> <span class="kc">true</span>
    <span class="k">repeat:</span> <span class="kc">true</span>
    <span class="k">onTriggered:</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">getSeconds</span><span class="p">());</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p class="rubric">Call a function by name</p>
<div class="highlight-qml notranslate"><div class="highlight"><pre><span></span><span class="nx">Item</span> <span class="p">{</span>
  <span class="kd">id: root</span>

  <span class="kd">function</span> <span class="nx">doIt</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;doIt()&quot;</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">Component.onCompleted:</span> <span class="p">{</span>
    <span class="c1">// Call using function execution</span>
    <span class="nx">root</span><span class="p">[</span><span class="s2">&quot;doIt&quot;</span><span class="p">]();</span>
    <span class="kd">var</span> <span class="nx">fn</span> <span class="o">=</span> <span class="nx">root</span><span class="p">[</span><span class="s2">&quot;doIt&quot;</span><span class="p">];</span>
    <span class="c1">// Call using JS call method (could pass in a custom this object and arguments)</span>
    <span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-a-js-console">
<h2>16.4. Creating a JS Console<a class="headerlink" href="#creating-a-js-console" title="Permalink to this headline">Â¶</a></h2>
<p>As a little example, we will create a JS console. We need an input field where the user can enter his JS expressions and ideally there should be a list of output results. As this should more look like a desktop application we use the QtQuick Controls module.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A JS console inside your next project can be really beneficial for testing. Enhanced with a Quake-Terminal effect it is also good to impress customers. To use it wisely you need to control the scope the JS console evaluates in, e.g. the currently visible screen, the main data model, a singleton core object or all together.</p>
</div>
<div class="figure">
<img alt="../_images/jsconsole.png" src="../_images/jsconsole.png" />
</div>
<p>We use Qt Creator to create a Qt Quick UI project using QtQuick controls. We call the project <cite>JSConsole</cite>. After the wizard has finished we have already a basic structure for the application with an application window and a menu to exit the application.</p>
<p>For the input, we use a TextField and a Button to send the input for evaluation. The result of the expression evaluation is displayed using a ListView with a ListModel as the model and two labels to display the expression and the evaluated result.</p>
<div class="highlight-qml notranslate"><div class="highlight"><pre><span></span><span class="c1">// part of JSConsole.qml</span>
<span class="nx">ApplicationWindow</span> <span class="p">{</span>
  <span class="kd">id: root</span>

  <span class="p">...</span>

  <span class="nx">ColumnLayout</span> <span class="p">{</span>
      <span class="k">anchors.fill:</span> <span class="nx">parent</span>
      <span class="k">anchors.margins:</span> <span class="mi">9</span>
      <span class="nx">RowLayout</span> <span class="p">{</span>
          <span class="k">Layout.fillWidth:</span> <span class="kc">true</span>
          <span class="nx">TextField</span> <span class="p">{</span>
              <span class="kd">id: input</span>
              <span class="k">Layout.fillWidth:</span> <span class="kc">true</span>
              <span class="k">focus:</span> <span class="kc">true</span>
              <span class="k">onAccepted:</span> <span class="p">{</span>
                  <span class="c1">// call our evaluation function on root</span>
                  <span class="nx">root</span><span class="p">.</span><span class="nx">jsCall</span><span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">text</span><span class="p">)</span>
              <span class="p">}</span>
          <span class="p">}</span>
          <span class="nx">Button</span> <span class="p">{</span>
              <span class="k">text:</span> <span class="nx">qsTr</span><span class="p">(</span><span class="s2">&quot;Send&quot;</span><span class="p">)</span>
              <span class="k">onClicked:</span> <span class="p">{</span>
                  <span class="c1">// call our evaluation function on root</span>
                  <span class="nx">root</span><span class="p">.</span><span class="nx">jsCall</span><span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">text</span><span class="p">)</span>
              <span class="p">}</span>
          <span class="p">}</span>
      <span class="p">}</span>
      <span class="nx">Item</span> <span class="p">{</span>
          <span class="k">Layout.fillWidth:</span> <span class="kc">true</span>
          <span class="k">Layout.fillHeight:</span> <span class="kc">true</span>
          <span class="nx">Rectangle</span> <span class="p">{</span>
              <span class="k">anchors.fill:</span> <span class="nx">parent</span>
              <span class="k">color:</span> <span class="s1">&#39;#333&#39;</span>
              <span class="k">border.color:</span> <span class="nx">Qt</span><span class="p">.</span><span class="nx">darker</span><span class="p">(</span><span class="nx">color</span><span class="p">)</span>
              <span class="k">opacity:</span> <span class="mf">0.2</span>
              <span class="k">radius:</span> <span class="mi">2</span>
          <span class="p">}</span>

          <span class="nx">ScrollView</span> <span class="p">{</span>
              <span class="kd">id: scrollView</span>
              <span class="k">anchors.fill:</span> <span class="nx">parent</span>
              <span class="k">anchors.margins:</span> <span class="mi">9</span>
              <span class="nx">ListView</span> <span class="p">{</span>
                  <span class="kd">id: resultView</span>
                  <span class="k">model:</span> <span class="nx">ListModel</span> <span class="p">{</span>
                      <span class="kd">id: outputModel</span>
                  <span class="p">}</span>
                  <span class="k">delegate:</span> <span class="nx">ColumnLayout</span> <span class="p">{</span>
                      <span class="k">width:</span> <span class="nx">ListView</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">width</span>
                      <span class="nx">Label</span> <span class="p">{</span>
                          <span class="k">Layout.fillWidth:</span> <span class="kc">true</span>
                          <span class="k">color:</span> <span class="s1">&#39;green&#39;</span>
                          <span class="k">text:</span> <span class="s2">&quot;&gt; &quot;</span> <span class="o">+</span> <span class="nx">model</span><span class="p">.</span><span class="nx">expression</span>
                      <span class="p">}</span>
                      <span class="nx">Label</span> <span class="p">{</span>
                          <span class="k">Layout.fillWidth:</span> <span class="kc">true</span>
                          <span class="k">color:</span> <span class="s1">&#39;blue&#39;</span>
                          <span class="k">text:</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nx">model</span><span class="p">.</span><span class="nx">result</span>
                      <span class="p">}</span>
                      <span class="nx">Rectangle</span> <span class="p">{</span>
                          <span class="k">height:</span> <span class="mi">1</span>
                          <span class="k">Layout.fillWidth:</span> <span class="kc">true</span>
                          <span class="k">color:</span> <span class="s1">&#39;#333&#39;</span>
                          <span class="k">opacity:</span> <span class="mf">0.2</span>
                      <span class="p">}</span>
                  <span class="p">}</span>
              <span class="p">}</span>
          <span class="p">}</span>
      <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The evaluation function <code class="docutils literal notranslate"><span class="pre">jsCall</span></code> does the evaluation not by itself this has been moved to a JS module (<code class="docutils literal notranslate"><span class="pre">jsconsole.js</span></code>) for clearer separation.</p>
<div class="highlight-qml notranslate"><div class="highlight"><pre><span></span><span class="c1">// part of JSConsole.qml</span>

<span class="kr">import</span> <span class="s2">&quot;jsconsole.js&quot;</span> <span class="nx">as</span> <span class="nx">Util</span>

<span class="p">...</span>

<span class="nx">ApplicationWindow</span> <span class="p">{</span>
  <span class="kd">id: root</span>

  <span class="p">...</span>

  <span class="kd">function</span> <span class="nx">jsCall</span><span class="p">(</span><span class="nx">exp</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">Util</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">exp</span><span class="p">);</span>
      <span class="c1">// insert the result at the beginning of the list</span>
      <span class="nx">outputModel</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For safety, we do not use the <code class="docutils literal notranslate"><span class="pre">eval</span></code> function from JS as this would allow the user to modify the local scope. We use the Function constructor to create a JS function on runtime and pass in our scope as this variable. As the function is created every time it does not act as a closure and stores its own scope, we need to use <code class="docutils literal notranslate"><span class="pre">this.a</span> <span class="pre">=</span> <span class="pre">10</span></code> to store the value inside this scope of the function. This scope is set by the script to the scope variable.</p>
<div class="highlight-qml notranslate"><div class="highlight"><pre><span></span><span class="c1">// jsconsole.js</span>
<span class="p">.</span><span class="nx">pragma</span> <span class="nx">library</span>

<span class="kd">var</span> <span class="nx">scope</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// our custom scope injected into our function evaluation</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">call</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">exp</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">exp</span><span class="p">)</span>
    <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="k">expression :</span> <span class="nx">msg</span>
    <span class="p">}</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">fun</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Function</span><span class="p">(</span><span class="s1">&#39;return (&#39;</span> <span class="o">+</span> <span class="nx">exp</span> <span class="o">+</span> <span class="s1">&#39;);&#39;</span><span class="p">);</span>
        <span class="nx">data</span><span class="p">.</span><span class="nx">result</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">fun</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">scope</span><span class="p">),</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;scope: &#39;</span> <span class="o">+</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">scope</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;result: &#39;</span> <span class="o">+</span> <span class="nx">result</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
        <span class="nx">data</span><span class="p">.</span><span class="nx">error</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">data</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The data return from the call function is a JS object with a result, expression and error property: <code class="docutils literal notranslate"><span class="pre">data:</span> <span class="pre">{</span> <span class="pre">expression:</span> <span class="pre">{},</span> <span class="pre">result:</span> <span class="pre">{},</span> <span class="pre">error:</span> <span class="pre">{}</span> <span class="pre">}</span></code>. We can use this JS object directly inside the ListModel and access it then from the delegate, e.g. <code class="docutils literal notranslate"><span class="pre">model.expression</span></code> gives us the input expression. For the simplicity of the example, we ignore the error result.</p>
</div>
</div>


    </div>
      
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2012-2018 JÃ¼rgen Bocklage-Ryannel and Johan Thelin. This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.<br/>
      Last updated on Nov 10, 2020.<br/>
    </p>
  </div>
</footer>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46104829-1', 'auto');
  ga('send', 'pageview');

</script>

  </body>
</html>